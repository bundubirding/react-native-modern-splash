{"version":3,"file":"compile.js","names":["_path","_interopRequireDefault","require","_fsExtra","_kleur","babel","_interopRequireWildcard","_glob","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","sourceExt","compile","root","source","output","esm","babelrc","configFile","exclude","modules","copyFlow","sourceMaps","report","jsxRuntime","files","glob","sync","cwd","absolute","nodir","ignore","info","kleur","blue","String","length","path","relative","pkg","JSON","parse","fs","readFile","join","keys","devDependencies","includes","warn","mkdirp","writeJSON","type","Promise","all","map","filepath","outputFilename","replace","dirname","test","copy","content","result","transformAsync","caller","name","supportsStaticESM","rewriteImportExtensions","sourceRoot","sourceFileName","filename","presets","resolve","Error","code","mapFilename","basename","sourcesContent","undefined","writeFile","success","getGeneratedEntryPath","ext","indexName","potentialPath","pathExists","fields","value","main","module","push","exports","import","some","field","startsWith","error","generatedEntryPath"],"sources":["../../src/utils/compile.ts"],"sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport kleur from 'kleur';\nimport * as babel from '@babel/core';\nimport glob from 'glob';\nimport type { Input } from '../types';\n\ntype Options = Input & {\n  esm?: boolean;\n  babelrc?: boolean | null;\n  configFile?: string | false | null;\n  sourceMaps?: boolean;\n  copyFlow?: boolean;\n  modules: 'commonjs' | 'preserve';\n  exclude: string;\n  jsxRuntime?: 'automatic' | 'classic';\n};\n\nconst sourceExt = /\\.([cm])?[jt]sx?$/;\n\nexport default async function compile({\n  root,\n  source,\n  output,\n  esm = false,\n  babelrc = false,\n  configFile = false,\n  exclude,\n  modules,\n  copyFlow,\n  sourceMaps = true,\n  report,\n  jsxRuntime = 'automatic',\n}: Options) {\n  const files = glob.sync('**/*', {\n    cwd: source,\n    absolute: true,\n    nodir: true,\n    ignore: exclude,\n  });\n\n  report.info(\n    `Compiling ${kleur.blue(String(files.length))} files in ${kleur.blue(\n      path.relative(root, source)\n    )} with ${kleur.blue('babel')}`\n  );\n\n  const pkg = JSON.parse(\n    await fs.readFile(path.join(root, 'package.json'), 'utf-8')\n  );\n\n  if (copyFlow) {\n    if (!Object.keys(pkg.devDependencies || {}).includes('flow-bin')) {\n      report.warn(\n        `The ${kleur.blue(\n          'copyFlow'\n        )} option was specified, but couldn't find ${kleur.blue(\n          'flow-bin'\n        )} in ${kleur.blue(\n          'package.json'\n        )}.\\nIf the project is using ${kleur.blue(\n          'flow'\n        )}, then make sure you have added ${kleur.blue(\n          'flow-bin'\n        )} to your ${kleur.blue(\n          'devDependencies'\n        )}, otherwise remove the ${kleur.blue('copyFlow')} option.`\n      );\n    }\n  }\n\n  await fs.mkdirp(output);\n\n  if (!esm) {\n    // Ideally we should code with ESM syntax as CommonJS if `esm` is not enabled\n    // This maintain compatibility with code written for CommonJS\n    // However currently NextJS has non-standard behavior and breaks this\n    // So for now we only set this conditionally\n    await fs.writeJSON(path.join(output, 'package.json'), {\n      type: modules === 'commonjs' ? 'commonjs' : 'module',\n    });\n  }\n\n  await Promise.all(\n    files.map(async (filepath) => {\n      const outputFilename = path\n        .join(output, path.relative(source, filepath))\n        .replace(sourceExt, '.$1js');\n\n      await fs.mkdirp(path.dirname(outputFilename));\n\n      if (!sourceExt.test(filepath)) {\n        // Copy files which aren't source code\n        fs.copy(filepath, outputFilename);\n        return;\n      }\n\n      const content = await fs.readFile(filepath, 'utf-8');\n      const result = await babel.transformAsync(content, {\n        caller: {\n          name: 'react-native-builder-bob',\n          supportsStaticESM:\n            /\\.m[jt]s$/.test(filepath) || // If a file is explicitly marked as ESM, then preserve the syntax\n            modules === 'preserve'\n              ? true\n              : false,\n          rewriteImportExtensions: esm,\n          jsxRuntime,\n        },\n        cwd: root,\n        babelrc: babelrc,\n        configFile: configFile,\n        sourceMaps,\n        sourceRoot: path.relative(path.dirname(outputFilename), source),\n        sourceFileName: path.relative(source, filepath),\n        filename: filepath,\n        ...(babelrc || configFile\n          ? null\n          : {\n              presets: [require.resolve('../../babel-preset')],\n            }),\n      });\n\n      if (result == null) {\n        throw new Error('Output code was null');\n      }\n\n      let code = result.code;\n\n      if (sourceMaps && result.map) {\n        const mapFilename = outputFilename + '.map';\n\n        code += '\\n//# sourceMappingURL=' + path.basename(mapFilename);\n\n        // Don't inline the source code, it can be retrieved from the source file\n        result.map.sourcesContent = undefined;\n\n        await fs.writeJSON(mapFilename, result.map);\n      }\n\n      await fs.writeFile(outputFilename, code);\n\n      if (copyFlow) {\n        fs.copy(filepath, outputFilename + '.flow');\n      }\n    })\n  );\n\n  report.success(`Wrote files to ${kleur.blue(path.relative(root, output))}`);\n\n  const getGeneratedEntryPath = async () => {\n    if (pkg.source) {\n      for (const ext of ['.js', '.cjs', '.mjs']) {\n        const indexName =\n          // The source field may not have an extension, so we add it instead of replacing directly\n          path.basename(pkg.source).replace(sourceExt, '') + ext;\n\n        const potentialPath = path.join(\n          output,\n          path.dirname(path.relative(source, path.join(root, pkg.source))),\n          indexName\n        );\n\n        if (await fs.pathExists(potentialPath)) {\n          return path.relative(root, potentialPath);\n        }\n      }\n    }\n\n    return null;\n  };\n\n  const fields =\n    modules === 'commonjs'\n      ? [{ name: 'main', value: pkg.main }]\n      : [{ name: 'module', value: pkg.module }];\n\n  if (esm) {\n    if (modules === 'commonjs') {\n      fields.push(\n        typeof pkg.exports?.['.']?.require === 'string'\n          ? {\n              name: \"exports['.'].require\",\n              value: pkg.exports?.['.']?.require,\n            }\n          : {\n              name: \"exports['.'].require.default\",\n              value: pkg.exports?.['.']?.require?.default,\n            }\n      );\n    } else {\n      fields.push(\n        typeof pkg.exports?.['.']?.import === 'string'\n          ? {\n              name: \"exports['.'].import\",\n              value: pkg.exports?.['.']?.import,\n            }\n          : {\n              name: \"exports['.'].import.default\",\n              value: pkg.exports?.['.']?.import?.default,\n            }\n      );\n    }\n  } else {\n    if (modules === 'commonjs' && pkg.exports?.['.']?.require) {\n      report.warn(\n        `The ${kleur.blue('esm')} option is disabled, but the ${kleur.blue(\n          \"exports['.'].require\"\n        )} field is set in ${kleur.blue(\n          'package.json'\n        )}. This is likely a mistake.`\n      );\n    } else if (modules === 'preserve' && pkg.exports?.['.']?.import) {\n      report.warn(\n        `The ${kleur.blue('esm')} option is disabled, but the ${kleur.blue(\n          \"exports['.'].import\"\n        )} field is set in ${kleur.blue(\n          'package.json'\n        )}. This is likely a mistake.`\n      );\n    }\n  }\n\n  if (fields.some((field) => field.value)) {\n    await Promise.all(\n      fields.map(async ({ name, value }) => {\n        if (!value) {\n          return;\n        }\n\n        if (name.startsWith('exports') && value && !/^\\.\\//.test(value)) {\n          report.error(\n            `The ${kleur.blue(name)} field in ${kleur.blue(\n              `package.json`\n            )} should be a relative path starting with ${kleur.blue(\n              './'\n            )}. Found: ${kleur.blue(value)}`\n          );\n\n          throw new Error(`Found incorrect path in '${name}' field.`);\n        }\n\n        try {\n          require.resolve(path.join(root, value));\n        } catch (e: unknown) {\n          if (\n            e != null &&\n            typeof e === 'object' &&\n            'code' in e &&\n            e.code === 'MODULE_NOT_FOUND'\n          ) {\n            const generatedEntryPath = await getGeneratedEntryPath();\n\n            if (!generatedEntryPath) {\n              report.warn(\n                `Failed to detect the entry point for the generated files. Make sure you have a valid ${kleur.blue(\n                  'source'\n                )} field in your ${kleur.blue('package.json')}.`\n              );\n            }\n\n            report.error(\n              `The ${kleur.blue(name)} field in ${kleur.blue(\n                'package.json'\n              )} points to a non-existent file: ${kleur.blue(\n                value\n              )}.\\nVerify the path points to the correct file under ${kleur.blue(\n                path.relative(root, output)\n              )}${\n                generatedEntryPath\n                  ? ` (found ${kleur.blue(generatedEntryPath)}).`\n                  : '.'\n              }`\n            );\n\n            throw new Error(`Found incorrect path in '${name}' field.`);\n          }\n\n          throw e;\n        }\n      })\n    );\n  } else {\n    const generatedEntryPath = await getGeneratedEntryPath();\n\n    report.warn(\n      `No ${fields\n        .map((field) => kleur.blue(field.name))\n        .join(' or ')} field found in ${kleur.blue('package.json')}. Consider ${\n        generatedEntryPath\n          ? `pointing to ${kleur.blue(generatedEntryPath)}`\n          : `adding ${fields.length > 1 ? 'them' : 'it'}`\n      } so that consumers of your package can import your package.`\n    );\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,MAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,KAAA,GAAAC,uBAAA,CAAAJ,OAAA;AACA,IAAAK,KAAA,GAAAN,sBAAA,CAAAC,OAAA;AAAwB,SAAAM,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAH,wBAAAG,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAAA,SAAAhB,uBAAAQ,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAI,UAAA,GAAAJ,CAAA,KAAAK,OAAA,EAAAL,CAAA;AAcxB,MAAMmB,SAAS,GAAG,mBAAmB;AAEtB,eAAeC,OAAOA,CAAC;EACpCC,IAAI;EACJC,MAAM;EACNC,MAAM;EACNC,GAAG,GAAG,KAAK;EACXC,OAAO,GAAG,KAAK;EACfC,UAAU,GAAG,KAAK;EAClBC,OAAO;EACPC,OAAO;EACPC,QAAQ;EACRC,UAAU,GAAG,IAAI;EACjBC,MAAM;EACNC,UAAU,GAAG;AACN,CAAC,EAAE;EACV,MAAMC,KAAK,GAAGC,aAAI,CAACC,IAAI,CAAC,MAAM,EAAE;IAC9BC,GAAG,EAAEd,MAAM;IACXe,QAAQ,EAAE,IAAI;IACdC,KAAK,EAAE,IAAI;IACXC,MAAM,EAAEZ;EACV,CAAC,CAAC;EAEFI,MAAM,CAACS,IAAI,CACT,aAAaC,cAAK,CAACC,IAAI,CAACC,MAAM,CAACV,KAAK,CAACW,MAAM,CAAC,CAAC,aAAaH,cAAK,CAACC,IAAI,CAClEG,aAAI,CAACC,QAAQ,CAACzB,IAAI,EAAEC,MAAM,CAC5B,CAAC,SAASmB,cAAK,CAACC,IAAI,CAAC,OAAO,CAAC,EAC/B,CAAC;EAED,MAAMK,GAAG,GAAGC,IAAI,CAACC,KAAK,CACpB,MAAMC,gBAAE,CAACC,QAAQ,CAACN,aAAI,CAACO,IAAI,CAAC/B,IAAI,EAAE,cAAc,CAAC,EAAE,OAAO,CAC5D,CAAC;EAED,IAAIQ,QAAQ,EAAE;IACZ,IAAI,CAAClB,MAAM,CAAC0C,IAAI,CAACN,GAAG,CAACO,eAAe,IAAI,CAAC,CAAC,CAAC,CAACC,QAAQ,CAAC,UAAU,CAAC,EAAE;MAChExB,MAAM,CAACyB,IAAI,CACT,OAAOf,cAAK,CAACC,IAAI,CACf,UACF,CAAC,4CAA4CD,cAAK,CAACC,IAAI,CACrD,UACF,CAAC,OAAOD,cAAK,CAACC,IAAI,CAChB,cACF,CAAC,8BAA8BD,cAAK,CAACC,IAAI,CACvC,MACF,CAAC,mCAAmCD,cAAK,CAACC,IAAI,CAC5C,UACF,CAAC,YAAYD,cAAK,CAACC,IAAI,CACrB,iBACF,CAAC,0BAA0BD,cAAK,CAACC,IAAI,CAAC,UAAU,CAAC,UACnD,CAAC;IACH;EACF;EAEA,MAAMQ,gBAAE,CAACO,MAAM,CAAClC,MAAM,CAAC;EAEvB,IAAI,CAACC,GAAG,EAAE;IACR;IACA;IACA;IACA;IACA,MAAM0B,gBAAE,CAACQ,SAAS,CAACb,aAAI,CAACO,IAAI,CAAC7B,MAAM,EAAE,cAAc,CAAC,EAAE;MACpDoC,IAAI,EAAE/B,OAAO,KAAK,UAAU,GAAG,UAAU,GAAG;IAC9C,CAAC,CAAC;EACJ;EAEA,MAAMgC,OAAO,CAACC,GAAG,CACf5B,KAAK,CAAC6B,GAAG,CAAC,MAAOC,QAAQ,IAAK;IAC5B,MAAMC,cAAc,GAAGnB,aAAI,CACxBO,IAAI,CAAC7B,MAAM,EAAEsB,aAAI,CAACC,QAAQ,CAACxB,MAAM,EAAEyC,QAAQ,CAAC,CAAC,CAC7CE,OAAO,CAAC9C,SAAS,EAAE,OAAO,CAAC;IAE9B,MAAM+B,gBAAE,CAACO,MAAM,CAACZ,aAAI,CAACqB,OAAO,CAACF,cAAc,CAAC,CAAC;IAE7C,IAAI,CAAC7C,SAAS,CAACgD,IAAI,CAACJ,QAAQ,CAAC,EAAE;MAC7B;MACAb,gBAAE,CAACkB,IAAI,CAACL,QAAQ,EAAEC,cAAc,CAAC;MACjC;IACF;IAEA,MAAMK,OAAO,GAAG,MAAMnB,gBAAE,CAACC,QAAQ,CAACY,QAAQ,EAAE,OAAO,CAAC;IACpD,MAAMO,MAAM,GAAG,MAAM1E,KAAK,CAAC2E,cAAc,CAACF,OAAO,EAAE;MACjDG,MAAM,EAAE;QACNC,IAAI,EAAE,0BAA0B;QAChCC,iBAAiB,EACf,WAAW,CAACP,IAAI,CAACJ,QAAQ,CAAC;QAAI;QAC9BnC,OAAO,KAAK,UAAU,GAClB,IAAI,GACJ,KAAK;QACX+C,uBAAuB,EAAEnD,GAAG;QAC5BQ;MACF,CAAC;MACDI,GAAG,EAAEf,IAAI;MACTI,OAAO,EAAEA,OAAO;MAChBC,UAAU,EAAEA,UAAU;MACtBI,UAAU;MACV8C,UAAU,EAAE/B,aAAI,CAACC,QAAQ,CAACD,aAAI,CAACqB,OAAO,CAACF,cAAc,CAAC,EAAE1C,MAAM,CAAC;MAC/DuD,cAAc,EAAEhC,aAAI,CAACC,QAAQ,CAACxB,MAAM,EAAEyC,QAAQ,CAAC;MAC/Ce,QAAQ,EAAEf,QAAQ;MAClB,IAAItC,OAAO,IAAIC,UAAU,GACrB,IAAI,GACJ;QACEqD,OAAO,EAAE,CAACtF,OAAO,CAACuF,OAAO,CAAC,oBAAoB,CAAC;MACjD,CAAC;IACP,CAAC,CAAC;IAEF,IAAIV,MAAM,IAAI,IAAI,EAAE;MAClB,MAAM,IAAIW,KAAK,CAAC,sBAAsB,CAAC;IACzC;IAEA,IAAIC,IAAI,GAAGZ,MAAM,CAACY,IAAI;IAEtB,IAAIpD,UAAU,IAAIwC,MAAM,CAACR,GAAG,EAAE;MAC5B,MAAMqB,WAAW,GAAGnB,cAAc,GAAG,MAAM;MAE3CkB,IAAI,IAAI,yBAAyB,GAAGrC,aAAI,CAACuC,QAAQ,CAACD,WAAW,CAAC;;MAE9D;MACAb,MAAM,CAACR,GAAG,CAACuB,cAAc,GAAGC,SAAS;MAErC,MAAMpC,gBAAE,CAACQ,SAAS,CAACyB,WAAW,EAAEb,MAAM,CAACR,GAAG,CAAC;IAC7C;IAEA,MAAMZ,gBAAE,CAACqC,SAAS,CAACvB,cAAc,EAAEkB,IAAI,CAAC;IAExC,IAAIrD,QAAQ,EAAE;MACZqB,gBAAE,CAACkB,IAAI,CAACL,QAAQ,EAAEC,cAAc,GAAG,OAAO,CAAC;IAC7C;EACF,CAAC,CACH,CAAC;EAEDjC,MAAM,CAACyD,OAAO,CAAC,kBAAkB/C,cAAK,CAACC,IAAI,CAACG,aAAI,CAACC,QAAQ,CAACzB,IAAI,EAAEE,MAAM,CAAC,CAAC,EAAE,CAAC;EAE3E,MAAMkE,qBAAqB,GAAG,MAAAA,CAAA,KAAY;IACxC,IAAI1C,GAAG,CAACzB,MAAM,EAAE;MACd,KAAK,MAAMoE,GAAG,IAAI,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,EAAE;QACzC,MAAMC,SAAS;QACb;QACA9C,aAAI,CAACuC,QAAQ,CAACrC,GAAG,CAACzB,MAAM,CAAC,CAAC2C,OAAO,CAAC9C,SAAS,EAAE,EAAE,CAAC,GAAGuE,GAAG;QAExD,MAAME,aAAa,GAAG/C,aAAI,CAACO,IAAI,CAC7B7B,MAAM,EACNsB,aAAI,CAACqB,OAAO,CAACrB,aAAI,CAACC,QAAQ,CAACxB,MAAM,EAAEuB,aAAI,CAACO,IAAI,CAAC/B,IAAI,EAAE0B,GAAG,CAACzB,MAAM,CAAC,CAAC,CAAC,EAChEqE,SACF,CAAC;QAED,IAAI,MAAMzC,gBAAE,CAAC2C,UAAU,CAACD,aAAa,CAAC,EAAE;UACtC,OAAO/C,aAAI,CAACC,QAAQ,CAACzB,IAAI,EAAEuE,aAAa,CAAC;QAC3C;MACF;IACF;IAEA,OAAO,IAAI;EACb,CAAC;EAED,MAAME,MAAM,GACVlE,OAAO,KAAK,UAAU,GAClB,CAAC;IAAE6C,IAAI,EAAE,MAAM;IAAEsB,KAAK,EAAEhD,GAAG,CAACiD;EAAK,CAAC,CAAC,GACnC,CAAC;IAAEvB,IAAI,EAAE,QAAQ;IAAEsB,KAAK,EAAEhD,GAAG,CAACkD;EAAO,CAAC,CAAC;EAE7C,IAAIzE,GAAG,EAAE;IACP,IAAII,OAAO,KAAK,UAAU,EAAE;MAC1BkE,MAAM,CAACI,IAAI,CACT,OAAOnD,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAE1G,OAAO,KAAK,QAAQ,GAC3C;QACEgF,IAAI,EAAE,sBAAsB;QAC5BsB,KAAK,EAAEhD,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAE1G;MAC7B,CAAC,GACD;QACEgF,IAAI,EAAE,8BAA8B;QACpCsB,KAAK,EAAEhD,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAE1G,OAAO,EAAEY;MACtC,CACN,CAAC;IACH,CAAC,MAAM;MACLyF,MAAM,CAACI,IAAI,CACT,OAAOnD,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAEC,MAAM,KAAK,QAAQ,GAC1C;QACE3B,IAAI,EAAE,qBAAqB;QAC3BsB,KAAK,EAAEhD,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAEC;MAC7B,CAAC,GACD;QACE3B,IAAI,EAAE,6BAA6B;QACnCsB,KAAK,EAAEhD,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAEC,MAAM,EAAE/F;MACrC,CACN,CAAC;IACH;EACF,CAAC,MAAM;IACL,IAAIuB,OAAO,KAAK,UAAU,IAAImB,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAE1G,OAAO,EAAE;MACzDsC,MAAM,CAACyB,IAAI,CACT,OAAOf,cAAK,CAACC,IAAI,CAAC,KAAK,CAAC,gCAAgCD,cAAK,CAACC,IAAI,CAChE,sBACF,CAAC,oBAAoBD,cAAK,CAACC,IAAI,CAC7B,cACF,CAAC,6BACH,CAAC;IACH,CAAC,MAAM,IAAId,OAAO,KAAK,UAAU,IAAImB,GAAG,CAACoD,OAAO,GAAG,GAAG,CAAC,EAAEC,MAAM,EAAE;MAC/DrE,MAAM,CAACyB,IAAI,CACT,OAAOf,cAAK,CAACC,IAAI,CAAC,KAAK,CAAC,gCAAgCD,cAAK,CAACC,IAAI,CAChE,qBACF,CAAC,oBAAoBD,cAAK,CAACC,IAAI,CAC7B,cACF,CAAC,6BACH,CAAC;IACH;EACF;EAEA,IAAIoD,MAAM,CAACO,IAAI,CAAEC,KAAK,IAAKA,KAAK,CAACP,KAAK,CAAC,EAAE;IACvC,MAAMnC,OAAO,CAACC,GAAG,CACfiC,MAAM,CAAChC,GAAG,CAAC,OAAO;MAAEW,IAAI;MAAEsB;IAAM,CAAC,KAAK;MACpC,IAAI,CAACA,KAAK,EAAE;QACV;MACF;MAEA,IAAItB,IAAI,CAAC8B,UAAU,CAAC,SAAS,CAAC,IAAIR,KAAK,IAAI,CAAC,OAAO,CAAC5B,IAAI,CAAC4B,KAAK,CAAC,EAAE;QAC/DhE,MAAM,CAACyE,KAAK,CACV,OAAO/D,cAAK,CAACC,IAAI,CAAC+B,IAAI,CAAC,aAAahC,cAAK,CAACC,IAAI,CAC5C,cACF,CAAC,4CAA4CD,cAAK,CAACC,IAAI,CACrD,IACF,CAAC,YAAYD,cAAK,CAACC,IAAI,CAACqD,KAAK,CAAC,EAChC,CAAC;QAED,MAAM,IAAId,KAAK,CAAC,4BAA4BR,IAAI,UAAU,CAAC;MAC7D;MAEA,IAAI;QACFhF,OAAO,CAACuF,OAAO,CAACnC,aAAI,CAACO,IAAI,CAAC/B,IAAI,EAAE0E,KAAK,CAAC,CAAC;MACzC,CAAC,CAAC,OAAO/F,CAAU,EAAE;QACnB,IACEA,CAAC,IAAI,IAAI,IACT,OAAOA,CAAC,KAAK,QAAQ,IACrB,MAAM,IAAIA,CAAC,IACXA,CAAC,CAACkF,IAAI,KAAK,kBAAkB,EAC7B;UACA,MAAMuB,kBAAkB,GAAG,MAAMhB,qBAAqB,CAAC,CAAC;UAExD,IAAI,CAACgB,kBAAkB,EAAE;YACvB1E,MAAM,CAACyB,IAAI,CACT,wFAAwFf,cAAK,CAACC,IAAI,CAChG,QACF,CAAC,kBAAkBD,cAAK,CAACC,IAAI,CAAC,cAAc,CAAC,GAC/C,CAAC;UACH;UAEAX,MAAM,CAACyE,KAAK,CACV,OAAO/D,cAAK,CAACC,IAAI,CAAC+B,IAAI,CAAC,aAAahC,cAAK,CAACC,IAAI,CAC5C,cACF,CAAC,mCAAmCD,cAAK,CAACC,IAAI,CAC5CqD,KACF,CAAC,uDAAuDtD,cAAK,CAACC,IAAI,CAChEG,aAAI,CAACC,QAAQ,CAACzB,IAAI,EAAEE,MAAM,CAC5B,CAAC,GACCkF,kBAAkB,GACd,WAAWhE,cAAK,CAACC,IAAI,CAAC+D,kBAAkB,CAAC,IAAI,GAC7C,GAAG,EAEX,CAAC;UAED,MAAM,IAAIxB,KAAK,CAAC,4BAA4BR,IAAI,UAAU,CAAC;QAC7D;QAEA,MAAMzE,CAAC;MACT;IACF,CAAC,CACH,CAAC;EACH,CAAC,MAAM;IACL,MAAMyG,kBAAkB,GAAG,MAAMhB,qBAAqB,CAAC,CAAC;IAExD1D,MAAM,CAACyB,IAAI,CACT,MAAMsC,MAAM,CACThC,GAAG,CAAEwC,KAAK,IAAK7D,cAAK,CAACC,IAAI,CAAC4D,KAAK,CAAC7B,IAAI,CAAC,CAAC,CACtCrB,IAAI,CAAC,MAAM,CAAC,mBAAmBX,cAAK,CAACC,IAAI,CAAC,cAAc,CAAC,cAC1D+D,kBAAkB,GACd,eAAehE,cAAK,CAACC,IAAI,CAAC+D,kBAAkB,CAAC,EAAE,GAC/C,UAAUX,MAAM,CAAClD,MAAM,GAAG,CAAC,GAAG,MAAM,GAAG,IAAI,EAAE,6DAErD,CAAC;EACH;AACF","ignoreList":[]}